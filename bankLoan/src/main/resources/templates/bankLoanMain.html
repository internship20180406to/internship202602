<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ãƒ­ãƒ¼ãƒ³ç”³è¾¼æƒ…å ±å…¥åŠ›ç”»é¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .container {
            background-color: #ffffff;
            width: 100%;
            max-width: 700px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .progress-bar {
            height: 4px;
            background-color: rgba(255, 255, 255, 0.3);
        }

        .progress-fill {
            height: 100%;
            background-color: #4caf50;
            width: 33%;
            transition: width 0.3s ease;
        }

        .content {
            padding: 40px 30px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group label .required {
            color: #e74c3c;
            margin-left: 4px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-control:disabled,
        .form-control[readonly] {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        .form-control[readonly] {
            border-color: #ddd;
            color: #666;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 20px;
            padding-right: 40px;
        }

        .error-message-container {
            background-color: #fee;
            border-left: 4px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message-container.show {
            display: block;
        }

        .error-message-container h3 {
            color: #c0392b;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .error-message-container ul {
            list-style-position: inside;
            color: #c0392b;
        }

        .error-message-container li {
            margin-bottom: 5px;
            font-size: 14px;
        }

        .warning-text {
            color: #e67e22;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .interest-rate-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }

        .interest-rate-box label {
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 5px;
        }

        .interest-rate-value {
            font-size: 32px;
            font-weight: 700;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
            justify-content: center;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: #e0e0e0;
            color: #333;
        }

        .btn-secondary:hover {
            background-color: #d0d0d0;
        }

        .area-search-container {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ddd;
            display: none;
        }

        .area-search-container.show {
            display: block;
        }

        .prefecture-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .prefecture-btn, .branch-btn, .back-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #f0f0f0;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .prefecture-btn:hover {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
        }

        .branch-btn:hover {
            background-color: #667eea;
            color: white;
            border-color: #667eea;
        }

        .back-btn {
            background-color: #95a5a6;
            color: white;
            border-color: #95a5a6;
            width: 100%;
            margin-bottom: 10px;
        }

        .back-btn:hover {
            background-color: #7f8c8d;
        }

        .branch-buttons-div {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        select:invalid {
            color: #999999;
        }

        .flex-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .flex-row > div:first-child {
            flex: 1;
        }

        .flex-row .btn {
            min-width: auto;
            padding: 12px 24px;
        }

        @media (max-width: 600px) {
            .container {
                border-radius: 0;
                max-width: 100%;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .content {
                padding: 25px 20px;
            }

            .btn {
                min-width: 100%;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>ğŸ¦ ãƒ­ãƒ¼ãƒ³ç”³è¾¼</h1>
        <p>å¿…è¦ãªæƒ…å ±ã‚’ã”å…¥åŠ›ãã ã•ã„</p>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
    </div>

    <div class="content">
        <form action="#" th:action="@{/bankLoanConfirmation}" th:object="${bankLoanApplication}" method="post" onsubmit="return validateFormBeforeSubmit(event)">
            <div id="errorMessageContainer" class="error-message-container">
                <h3>âš ï¸ å…¥åŠ›ã‚¨ãƒ©ãƒ¼</h3>
                <ul id="errorList"></ul>
            </div>

            <!-- åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="form-section">
                <div class="form-section-title">åŸºæœ¬æƒ…å ±</div>

                <div class="form-group">
                    <label>é‡‘èæ©Ÿé–¢å</label>
                    <input type="text" id="bankNameSelect" th:field="*{bankName}" class="form-control" value="ã‹ã‚ã‚‰ãã°éŠ€è¡Œ" readonly/>
                </div>

                <div class="form-group">
                    <label>æ”¯åº—å<span class="required" data-required-for="branchNameInput">â€»</span></label>
                    <div class="flex-row">
                        <div>
                            <input type="text" id="branchNameInput" th:field="*{branchName}" class="form-control" placeholder="æ”¯åº—åã‚’å…¥åŠ›ã¾ãŸã¯ã‚¨ãƒªã‚¢ã§æ¢ã™" list="branchNameList" autocomplete="off"/>
                            <datalist id="branchNameList"></datalist>
                            <span id="branchNameWarning" class="warning-text">è©²å½“ã™ã‚‹æ”¯åº—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆè­¦å‘Šï¼‰</span>
                        </div>
                        <button type="button" id="searchByAreaBtn" class="btn btn-secondary" style="min-width: auto; padding: 12px 18px; font-size: 13px;">æ¢ã™</button>
                    </div>
                    <div id="areaSearchContainer" class="area-search-container">
                        <h4 style="margin-bottom: 12px; font-size: 13px;">éƒ½é“åºœçœŒã‹ã‚‰æ¢ã™</h4>
                        <div id="prefectureButtonsContainer" class="prefecture-buttons"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label>å£åº§ç¨®åˆ¥<span class="required" data-required-for="bankAccountTypeSelect">â€»</span></label>
                    <select th:field="*{bankAccountType}" id="bankAccountTypeSelect" class="form-control" required>
                        <option value="" disabled hidden>å£åº§ç¨®åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="æ™®é€š">æ™®é€š</option>
                        <option value="å½“åº§">å½“åº§</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>å£åº§ç•ªå·<span class="required" data-required-for="bankAccountNum">â€»</span></label>
                    <input type="text" id="bankAccountNum" th:field="*{bankAccountNum}" class="form-control" placeholder="7æ¡ã®ç•ªå·"/>
                    <span id="bankAccountNumWarning" class="warning-text">å£åº§ç•ªå·ãŒ7æ¡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆè­¦å‘Šï¼‰</span>
                </div>

                <div class="form-group">
                    <label>ç”³è¾¼è€…å<span class="required" data-required-for="applicantName">â€»</span></label>
                    <input type="text" id="applicantName" th:field="*{name}" class="form-control" placeholder="å±±ç”° å¤ªéƒ"/>
                </div>
            </div>

            <!-- ãƒ­ãƒ¼ãƒ³æ¡ä»¶ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="form-section">
                <div class="form-section-title">ãƒ­ãƒ¼ãƒ³æ¡ä»¶</div>

                <div class="form-group">
                    <label>ãƒ­ãƒ¼ãƒ³ã®ç¨®é¡<span class="required" data-required-for="loanTypeSelect">â€»</span></label>
                    <select th:field="*{loanType}" id="loanTypeSelect" class="form-control" required>
                        <option value="" disabled hidden>ãƒ­ãƒ¼ãƒ³ã®ç¨®é¡ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="ä½å®…ãƒ­ãƒ¼ãƒ³">ä½å®…ãƒ­ãƒ¼ãƒ³</option>
                        <option value="ãƒã‚¤ã‚«ãƒ¼ãƒ­ãƒ¼ãƒ³">ãƒã‚¤ã‚«ãƒ¼ãƒ­ãƒ¼ãƒ³</option>
                        <option value="æ•™è‚²ãƒ­ãƒ¼ãƒ³">æ•™è‚²ãƒ­ãƒ¼ãƒ³</option>
                        <option value="ãƒ•ãƒªãƒ¼ãƒ­ãƒ¼ãƒ³">ãƒ•ãƒªãƒ¼ãƒ­ãƒ¼ãƒ³</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>å€Ÿå…¥é‡‘é¡(å††)<span class="required" data-required-for="loanAmount">â€»</span></label>
                    <input type="text" id="loanAmount" th:field="*{loanAmount}" class="form-control" placeholder="3000000"/>
                </div>

                <div class="form-group">
                    <label>å€Ÿå…¥å¹´å(å††)<span class="required" data-required-for="annualIncome">â€»</span></label>
                    <input type="text" id="annualIncome" th:field="*{annualIncome}" class="form-control" placeholder="5000000"/>
                </div>

                <div class="form-group">
                    <label>å€Ÿå…¥æœŸé–“(å¹´)<span class="required" data-required-for="loanPeriod">â€»</span></label>
                    <input type="number" id="loanPeriod" th:field="*{loanPeriod}" class="form-control" placeholder="20" min="1" max="50"/>
                </div>
            </div>

            <!-- é‡‘åˆ©è¡¨ç¤º -->
            <div class="interest-rate-box">
                <label>äºˆæƒ³é‡‘åˆ©</label>
                <div class="interest-rate-value" id="displayInterestRate">---</div>
                <small>% (å¹´ç‡)</small>
            </div>

            <!-- ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ— -->
            <div class="button-group">
                <input type="submit" value="ç¢ºèª" class="btn btn-primary"/>
                <input type="reset" id="clearButton" value="ã‚¯ãƒªã‚¢" class="btn btn-secondary"/>
            </div>
        </form>
    </div>
</div>

<!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã«é…ç½® -->
<script th:inline="javascript">

        /* é¸æŠè‚¢ã®ã€Œã€œã‚’é¸æŠã—ã¦ãã ã•ã„ã€ã®æ–‡å­—è‰²ã‚’placeholderåŒæ§˜ã®è–„ã„ã‚°ãƒ¬ãƒ¼ã«è¨­å®š */
        select {
            color: #333333;
        }
        select option {
            color: #333333;
        }
        select option[value=""] {
            color: #999999;
        }
        /* selectãŒå€¤ã‚’æŒãŸãªã„å ´åˆï¼ˆæœªé¸æŠçŠ¶æ…‹ï¼‰ã®ãƒ†ã‚­ã‚¹ãƒˆè‰²ã‚’è–„ã„ã‚°ãƒ¬ãƒ¼ã« */
        select:invalid {
            color: #999999;
        }
        /* æ”¯åº—åã®é …ç›®ã‚’åˆæœŸçŠ¶æ…‹ã§éè¡¨ç¤º */
        #branchNameContainer {
            display: none;
        }

        /* æ”¯åº—åãŒè¡¨ç¤ºã•ã‚Œã‚‹æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes slideInFadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #branchNameContainer.show {
            display: block;
            animation: slideInFadeIn 0.4s ease-out;
            background-color: #f0f8ff;
            border-left: 4px solid #2185D0;
            padding: 12px;
            border-radius: 4px;
            margin: 10px 0;
        }

        #branchNameContainer.show p {
            margin: 0;
        }
        .warning-text {
            color: #b36b00;
            font-size: 12px;
        }

    </style>
</head>
<body>
<div class="content">
    <h1>ãƒ­ãƒ¼ãƒ³ç”³è¾¼æƒ…å ±å…¥åŠ›</h1>
    <form action="#" th:action="@{/bankLoanConfirmation}" th:object="${bankLoanApplication}" method="post" onsubmit="return validateFormBeforeSubmit(event)">
        <div id="errorMessageContainer" class="error-message-container">
            <h3>âš ï¸ å…¥åŠ›ã‚¨ãƒ©ãƒ¼</h3>
            <ul id="errorList"></ul>
        </div>
        <p><label class="ml-1">é‡‘èæ©Ÿé–¢å:</label><br>
            <input type="text" id="bankNameSelect" th:field="*{bankName}" class="form-control" value="ã‹ã‚ã‚‰ãã°éŠ€è¡Œ" readonly/></p>
        <p><label class="ml-1">æ”¯åº—å:<small class="text-danger ml-1 required-mark" data-required-for="branchNameInput">â€»</small></label><br>
            <div style="display: flex; gap: 10px; align-items: center;">
                <div style="flex: 1;">
                    <input type="text" id="branchNameInput" th:field="*{branchName}" class="form-control" placeholder="æ”¯åº—åã‚’å…¥åŠ›ã¾ãŸã¯ã‚¨ãƒªã‚¢ã§æ¢ã™"
                           list="branchNameList" autocomplete="off"/>
                    <datalist id="branchNameList"></datalist>
                    <span id="branchNameWarning" class="warning-text" style="display:none; margin-top: 4px;">è©²å½“ã™ã‚‹æ”¯åº—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆè­¦å‘Šï¼‰</span>
                </div>
                <button type="button" id="searchByAreaBtn" class="form-control-button" style="width: auto; background-color: #2185D0; color: white; margin: 5px 0;">ã‚¨ãƒªã‚¢ã§æ¢ã™</button>
            </div>
        </p>
        <div id="areaSearchContainer" style="display: none; background-color: #f9f9f9; padding: 15px; border-radius: 4px; margin: 10px 0; border: 1px solid #ddd;">
            <h4 style="margin-top: 0;">éƒ½é“åºœçœŒã‹ã‚‰æ¢ã™</h4>
            <div id="prefectureButtonsContainer" style="display: flex; flex-wrap: wrap; gap: 8px;">
            </div>
        </div>
        <p><label class="ml-1">å£åº§ç¨®åˆ¥:<small class="text-danger ml-1 required-mark" data-required-for="bankAccountTypeSelect">â€»</small></label><br>
            <select th:field="*{bankAccountType}" id="bankAccountTypeSelect" class="form-control" required>
                <option value="" disabled hidden>å£åº§ç¨®åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="æ™®é€š">æ™®é€š</option>
                <option value="å½“åº§">å½“åº§</option>
            </select></p>
        <p><label class="ml-1">å£åº§ç•ªå·:<small class="text-danger ml-1 required-mark" data-required-for="bankAccountNum">â€»</small></label><br>
            <input type="number" id="bankAccountNum" th:field="*{bankAccountNum}" class="form-control" placeholder="1234567"/>
            <span id="bankAccountNumWarning" class="warning-text" style="display:none;">å£åº§ç•ªå·ãŒ7æ¡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆè­¦å‘Šï¼‰</span>
        </p>
        <p><label class="ml-1">ç”³è¾¼è€…å:<small class="text-danger ml-1 required-mark" data-required-for="applicantName">â€»</small></label><br>
            <input type="text" id="applicantName" th:field="*{name}" class="form-control" placeholder="å±±ç”° å¤ªéƒ"/></p>
        <p><label class="ml-1">ãƒ­ãƒ¼ãƒ³ã®ç¨®é¡:<small class="text-danger ml-1 required-mark" data-required-for="loanTypeSelect">â€»</small></label><br>
            <select th:field="*{loanType}" id="loanTypeSelect" class="form-control" required>
                <option value="" disabled hidden>ãƒ­ãƒ¼ãƒ³ã®ç¨®é¡ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="ä½å®…ãƒ­ãƒ¼ãƒ³">ä½å®…ãƒ­ãƒ¼ãƒ³</option>
                <option value="ãƒã‚¤ã‚«ãƒ¼ãƒ­ãƒ¼ãƒ³">ãƒã‚¤ã‚«ãƒ¼ãƒ­ãƒ¼ãƒ³</option>
                <option value="æ•™è‚²ãƒ­ãƒ¼ãƒ³">æ•™è‚²ãƒ­ãƒ¼ãƒ³</option>
                <option value="ãƒ•ãƒªãƒ¼ãƒ­ãƒ¼ãƒ³">ãƒ•ãƒªãƒ¼ãƒ­ãƒ¼ãƒ³</option>
            </select></p>
        <p><label class="ml-1">å€Ÿå…¥é‡‘é¡(å††):<small class="text-danger ml-1 required-mark" data-required-for="loanAmount">â€»</small></label><br>
            <input type="text" id="loanAmount" th:field="*{loanAmount}" class="form-control" placeholder="3000000"/></p>
        <p><label class="ml-1">å€Ÿå…¥å¹´å(å††):<small class="text-danger ml-1 required-mark" data-required-for="annualIncome">â€»</small></label><br>
            <input type="text" id="annualIncome" th:field="*{annualIncome}" class="form-control" placeholder="5000000"/></p>
        <p><label class="ml-1">å€Ÿå…¥æœŸé–“(å¹´):<small class="text-danger ml-1 required-mark" data-required-for="loanPeriod">â€»</small></label><br>
            <input type="number" id="loanPeriod" th:field="*{loanPeriod}" class="form-control" placeholder="20" min="1" max="50"/></p>
        <p><label class="ml-1">é‡‘åˆ©(%): </label><br>
            <span id="displayInterestRate" style="font-size: 18px; font-weight: bold; color: #2185D0;">---</span></p>
        <p style="text-align: center;"><input type="submit" value="ç¢ºèª"
                                              class="form-control-button form-confirmation-button"/>
            <input type="reset" id="clearButton" value="ã‚¯ãƒªã‚¢" class="form-control-button form-clear-button"/></p>
    </form>
</div>
<script th:inline="javascript">
    // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–æ™‚ã«å£åº§ç¨®åˆ¥ã‚’ç¢ºå®Ÿã«ãƒªã‚»ãƒƒãƒˆï¼ˆDOMContentLoadedå‰ã«å®Ÿè¡Œï¼‰
    document.addEventListener('DOMContentLoaded', function() {
        const bankAccountTypeSelect = document.getElementById('bankAccountTypeSelect');
        const loanTypeSelect = document.getElementById('loanTypeSelect');

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®ã¿ãƒªã‚»ãƒƒãƒˆ
        if (!sessionStorage.getItem('bankLoanFormData')) {
            if (bankAccountTypeSelect) {
                // ç¢ºå®Ÿã«æœ€åˆã®optionï¼ˆdisabled hiddenï¼‰ã«è¨­å®š
                bankAccountTypeSelect.selectedIndex = 0;
                bankAccountTypeSelect.value = '';
            }
            if (loanTypeSelect) {
                loanTypeSelect.selectedIndex = 0;
                loanTypeSelect.value = '';
            }
        }
    }, true); // ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ•ã‚§ãƒ¼ã‚ºã§å®Ÿè¡Œï¼ˆãƒãƒ–ãƒªãƒ³ã‚°å‰ã«å®Ÿè¡Œï¼‰

    // Thymeleafã‹ã‚‰æ”¯åº—æƒ…å ±ã‚’JavaScriptã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›
    const branchOptions = /*[[${branchOptions}]]*/;

    // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
    console.log('branchOptions:', branchOptions);

    // é‡‘èæ©Ÿé–¢å¤‰æ›´æ™‚ã«æ”¯åº—ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
    function updateBranchOptions() {
        // éƒ½é“åºœçœŒselectãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã®é–¢æ•°ã¯å®Ÿè³ªä¸è¦
        // äº’æ›æ€§ã®ãŸã‚ç©ºé–¢æ•°ã¨ã—ã¦ä¿æŒ
    }

    function updateRequiredMarks() {
        const marks = document.querySelectorAll('.required-mark');
        marks.forEach(function(mark) {
            const targetId = mark.getAttribute('data-required-for');
            const target = document.getElementById(targetId);
            if (!target) {
                return;
            }
            if (targetId === 'branchNameSelect') {
                const container = document.getElementById('branchNameContainer');
                if (container && !container.classList.contains('show')) {
                    mark.style.display = 'none';
                    return;
                }
            }
            const value = (target.value || '').trim();
            mark.style.display = value ? 'none' : 'inline';
        });
    }

    function attachRequiredMarkListeners() {
        const targets = [
            'branchNameInput',
            'bankAccountTypeSelect',
            'bankAccountNum',
            'applicantName',
            'loanTypeSelect',
            'loanAmount',
            'annualIncome',
            'loanPeriod'
        ];
        targets.forEach(function(id) {
            const el = document.getElementById(id);
            if (!el) {
                return;
            }
            const eventName = el.tagName.toLowerCase() === 'select' ? 'change' : 'input';
            el.addEventListener(eventName, updateRequiredMarks);
        });
    }

    function resetSelectToPlaceholder(selectEl) {
        if (!selectEl) {
            return;
        }
        selectEl.selectedIndex = 0;
        selectEl.value = '';
    }

    function resetFormSelections() {
        document.getElementById('branchNameInput').value = '';
        resetSelectToPlaceholder(document.getElementById('bankAccountTypeSelect'));
        resetSelectToPlaceholder(document.getElementById('loanTypeSelect'));

        if (typeof updateBankAccountNumWarning === 'function') {
            updateBankAccountNumWarning();
        }

        sessionStorage.removeItem('bankLoanFormData');

        const errorMessageContainer = document.getElementById('errorMessageContainer');
        if (errorMessageContainer) {
            errorMessageContainer.classList.remove('show');
        }

        // ã™ã¹ã¦ã®ã€Œâ€»ã€ã‚’è¡¨ç¤ºã•ã›ã‚‹
        updateRequiredMarks();
    }

    function initializeFromSessionStorage() {
        if (sessionStorage.getItem('bankLoanFormData')) {
            return;
        }

        const bankAccountTypeSelect = document.querySelector('[name="bankAccountType"]');
        const loanTypeSelect = document.querySelector('[name="loanType"]');

        if (bankAccountTypeSelect && bankAccountTypeSelect.value !== '') {
            bankAccountTypeSelect.value = '';
        }
        if (loanTypeSelect && loanTypeSelect.value !== '') {
            loanTypeSelect.value = '';
        }

        updateBranchOptions();
    }

    function attachClearButtonHandler() {
        const clearButton = document.getElementById('clearButton');
        if (!clearButton) {
            return;
        }
        clearButton.addEventListener('click', function() {
            setTimeout(resetFormSelections, 0);
        });
    }

    function attachAreaSearchHandler() {
        const searchByAreaBtn = document.getElementById('searchByAreaBtn');
        if (!searchByAreaBtn) {
            return;
        }
        searchByAreaBtn.addEventListener('click', function(e) {
            e.preventDefault();
            toggleAreaSearch();
        });
    }

    function initializeFormPage() {
        initializeFromSessionStorage();
        attachClearButtonHandler();
        attachRequiredMarkListeners();
        updateRequiredMarks();
        attachAreaSearchHandler();
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeFormPage);
    } else {
        initializeFormPage();
    }
</script>
<script src="/js/bankLoanConfirmation.js"></script>
</body>

</html>



